<!DOCTYPE html>
<html>

    <head>
        <title>IWS Feature Request System</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/common.css">
    </head>

    <body>
        <header>
            <h1>IWS Feature Request System</h1>
        </header>
        <form action="">
            <select id="client_selector" data-bind="options: clients, optionsText: 'name', optionsValue: 'value', optionsCaption: 'Select a client...', value:activeClient"></select>
        </form>

        <div id="client_requests" data-bind="foreach: featureRequests, visible: activeClient">
            <div class="feature_request">
                <h3 data-bind="text: title"></h3>
                <p class="target_date" data-bind="text: target_date"></p>
                <p>Priority: <span class="priority" data-bind="text: priority"></span></p>
                <p>Product Area: <span class="product_area" data-bind="text: product_area"></span></p>
                <p class="description" data-bind="text: description"></p>

            </div>
        </div>

        <div id="new_request_form" data-bind="visible: activeClient">
            <form action="create/" method="POST">
                <input type="submit" name="submit" value="Submit">
            </form>
        </div>

        <script type='text/javascript' src='/static/js/jquery-3.2.1.min.js'></script>
        <script type='text/javascript' src='/static/js/knockout-3.4.2.js'></script>

        <script type="text/javascript">
            // Class to represent a row in the seat reservations grid
            var model = {
                activeClient: ko.observable(''),
                clients: [
                    {'name':'Client A', 'value':'client_a'},
                    {'name':'Client B', 'value':'client_b'},
                    {'name':'Client C', 'value':'client_c'}
                ],
                featureRequests: ko.observableArray([]),
                addRequest: function() {
                    this.featureRequests.push({'title':'request'+(this.featureRequests().length+1)});
                }
            };

            ko.applyBindings(model);

            $('#client_selector').change(function(e) {
                if (e.target.value != undefined && e.target.value != '') {
                    $.get( "get/"+e.target.value, function( data ) {
                        model.featureRequests(data);
                    });
                } else {
                    model.featureRequests([]);
                }
            });
        </script>
    </body>

</html>
